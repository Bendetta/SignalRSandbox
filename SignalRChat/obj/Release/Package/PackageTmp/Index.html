<!DOCTYPE html>
<html>
<head>
    <title>SignalR Simple Chat</title>
    <link rel="stylesheet" href="css/ui-lightness/jquery-ui-1.10.2.custom.css" />
    <link rel="stylesheet" href="css/layout.css" />
    <link rel="stylesheet" href="css/colorpicker.css" />
    <style type="text/css">
        .container {
            background-color: #99CCFF;
            border: thick solid #808080;
            padding: 20px;
            margin: 20px;
        }

        .box {
            border: 1px solid black;
            width: 50px;
            height: 50px;
            cursor: pointer;
            display: inline-block;
            position: absolute;
        }

        input {
            position: absolute;
            top: 0;
            left: 0;
        }
    </style>
</head>
<body>
    <input type="text" maxlength="6" size="6" id="color">
    <!--Script references. -->
    <!--Reference the jQuery library. -->
    <script src="/Scripts/jquery-1.9.1.js" ></script>
    <!--Reference the SignalR library. -->
    <script src="/Scripts/jquery.signalR-1.0.1.js"></script>
    <script src="/Scripts/jquery-ui-1.10.2.custom.js"></script>
    <script src="/Scripts/layout.js"></script>
    <script src="/Scripts/eye.js"></script>
    <script src="/Scripts/colorpicker.js"></script>
    <script src="/Scripts/utils.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="/signalr/hubs"></script>
    <!--Add script to update the page and send messages.--> 
    <script type="text/javascript">
        $(function () {
            $('#color').ColorPicker({
               onChange: function(hsb, hex, rgb) {
                   $('#color').val(hex);
                   $('#' + username).css('backgroundColor', '#' + hex);
               } 
            });
            var username = prompt('Name?', '');
            var userColor = $('#color').val();
            var box = $('<div></div>').attr('id', username).addClass('box');
            $('body').prepend(box);
            $('#' + username).draggable({
                drag: dragBoxEvent
            });
            // Declare a proxy to reference the hub. 
            var hub = $.connection.chatHub;
            // Create a function that the hub can call to broadcast messages.
            hub.client.updateBoxLocation = function (x, y, name, color) {
                var target = $('#' + name);
                if (target.length > 0) {
                    $('#' + name).css('left', x + 'px').css('top', y + 'px').css('backgroundColor', '#' + color);
                } else {
                    var newbox = $('<div></div>').attr('id', name).addClass('box').css('backgroundColor', '#' + color);
                    $('body').prepend(newbox);
                }
            };
            // Start the connection.
            $.connection.hub.start().done(function () {

            });
            
            function dragBoxEvent(event, ui) {
                // Call the MoveBox method on the hub. 
                hub.server.moveBox(ui.offset.left, ui.offset.top, username, $('#color').val());
            }
        });
    </script>
</body>
</html>